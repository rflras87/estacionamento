<!DOCTYPE html>
<html lang="pt-br">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>{% block title %}ParkSystem{% endblock %} - Sistema de Estacionamento</title>
  
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  
   <style>
       body { background-color: #f8f9fa; }
       .navbar { box-shadow: 0 2px 4px rgba(0,0,0,.1); }
       .navbar-brand { font-weight: 700; letter-spacing: 0.5px; cursor: default; } /* cursor: default remove a 'mãozinha' do mouse */
      
       /* Estilo Moderno do Dropdown */
       .dropdown-menu { border: none; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); padding: 0.5rem 0; }
       .dropdown-item { padding: 8px 24px; font-weight: 500; color: #495057; display: flex; align-items: center; }
       .dropdown-item i { margin-right: 10px; font-size: 1.1em; }
       .dropdown-item:hover { background-color: #f8f9fa; color: #212529; }
      
       /* Cabeçalhos de Seção */
       .dropdown-header {
           font-size: 0.7rem;
           font-weight: 800;
           text-transform: uppercase;
           letter-spacing: 1px;
           padding: 8px 24px 4px;
           margin-top: 4px;
       }
       .dropdown-divider { margin: 0.5rem 0; border-top: 1px solid #f1f3f5; }
      
       /* Cards */
       .card { border: none; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
       .btn { border-radius: 6px; font-weight: 500; }
   </style>
</head>
<body>


   {% from "_macros.html" import botao_acao_tabela with context %}


   {% if session.get('user_id') %}
   <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
       <div class="container">
          
           <span class="navbar-brand">
               <i class="bi bi-p-square-fill me-2 text-warning"></i>ParkSystem
           </span>
          
           <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
               <span class="navbar-toggler-icon"></span>
           </button>
          
           <div class="collapse navbar-collapse" id="mainNav">
              
               <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                   <li class="nav-item">
                       <a class="nav-link" href="{{ url_for('home') }}"><i class="bi bi-house-door-fill me-1"></i> Início</a>
                   </li>
                  
                   <li class="nav-item dropdown">
                       <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                           <i class="bi bi-car-front-fill me-1"></i> Pátio
                       </a>
                       <ul class="dropdown-menu shadow">
                           <li>
                               <a class="dropdown-item" href="{{ url_for('dar_entrada') }}">
                                   <i class="bi bi-box-arrow-in-right me-2"></i> Dar Entrada
                               </a>
                           </li>
                           <li>
                               <a class="dropdown-item" href="{{ url_for('listar_estacionados') }}">
                                   <i class="bi bi-list-ul me-2"></i> Veículos Estacionados
                               </a>
                           </li>
                           <li><hr class="dropdown-divider"></li>
                           <li>
                               <a class="dropdown-item" href="{{ url_for('historico') }}">
                                   <i class="bi bi-clock-history me-2"></i> Histórico de Saídas
                               </a>
                           </li>
                       </ul>
                   </li>
               </ul>
              
               <ul class="navbar-nav ms-auto">
                   <li class="nav-item dropdown">
                       <a class="nav-link dropdown-toggle active d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
                           <i class="bi bi-person-circle me-2" style="font-size: 1.2rem;"></i>
                           {{ session['user_nome'] }}
                       </a>
                      
                       <ul class="dropdown-menu dropdown-menu-end" style="min-width: 240px;">
                          
                           <li>
                               <a class="dropdown-item" href="{{ url_for('perfil') }}">
                                   <i class="bi bi-person-badge"></i> Meu Perfil
                               </a>
                           </li>
                           <li><hr class="dropdown-divider"></li>


                           {% if caixa_status == 'ABERTO' %}
                               <li><h6 class="dropdown-header text-success">Caixa (Aberto)</h6></li>
                               <li>
                                   <a class="dropdown-item text-danger" href="{{ url_for('fechar_caixa') }}">
                                       <i class="bi bi-door-closed"></i> Fechar Caixa
                                   </a>
                               </li>
                           {% else %}
                               <li><h6 class="dropdown-header text-danger">Caixa (Fechado)</h6></li>
                               <li>
                                   <a class="dropdown-item text-success" href="{{ url_for('abrir_caixa') }}">
                                       <i class="bi bi-door-open"></i> Abrir Caixa
                                   </a>
                               </li>
                           {% endif %}


                           <li><hr class="dropdown-divider"></li>


                           <li><h6 class="dropdown-header text-primary">Gestão</h6></li>
                           <li>
                               <a class="dropdown-item" href="{{ url_for('listar_clientes') }}">
                                   <i class="bi bi-people"></i> Clientes
                               </a>
                           </li>
                          
                           {% if session['user_perfil'] == 'ADMIN' %}
                               <li>
                                   <a class="dropdown-item" href="{{ url_for('financeiro') }}">
                                       <i class="bi bi-cash-coin"></i> Financeiro
                                   </a>
                               </li>
                               <li><hr class="dropdown-divider"></li>
                              
                               <li><h6 class="dropdown-header text-danger">Sistema</h6></li>
                               <li>
                                   <a class="dropdown-item" href="{{ url_for('listar_usuarios') }}">
                                       <i class="bi bi-person-gear"></i> Usuários
                                   </a>
                               </li>
                               <li>
                                   <a class="dropdown-item" href="{{ url_for('configuracoes') }}">
                                       <i class="bi bi-sliders"></i> Configurações
                                   </a>
                               </li>
                           {% endif %}
                          
                           <li><hr class="dropdown-divider"></li>
                          
                           <li>
                               <a class="dropdown-item text-danger fw-bold" href="{{ url_for('logout') }}">
                                   <i class="bi bi-box-arrow-right"></i> Sair
                               </a>
                           </li>
                       </ul>
                   </li>
               </ul>
           </div>
       </div>
   </nav>
   {% endif %}
   <div class="container mt-4">
       {% with messages = get_flashed_messages(with_categories=true) %}
           {% if messages %}
               {% for category, message in messages %}
                   <div class="alert alert-{{ category }} alert-dismissible fade show shadow-sm border-0" role="alert">
                       <i class="bi bi-info-circle-fill me-2"></i> {{ message }}
                       <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                   </div>
               {% endfor %}
           {% endif %}
       {% endwith %}


       {% block content %}{% endblock %}
   </div>


   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
   <script>
       function confirmarAcao(acao, url, ehPerigoso = false) {
           if (confirm(`Tem certeza que deseja ${acao}?`)) {
               if (ehPerigoso) {
                   if (confirm("Esta ação não pode ser desfeita. Confirmar mesmo assim?")) {
                       window.location.href = url;
                   }
               } else {
                   window.location.href = url;
               }
           }
       }
   </script>
</body>
</html>